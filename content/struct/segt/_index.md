---
title: セグメント木
version: 1.0
prefix: $segt
---

{{< meta >}}

区間に対する演算を高速に処理するデータ構造です。

## 説明
配列 $A$ に対して、要素の更新と結合律を満たす区間に対する演算を何回も処理する場合に有用なデータ構造です。
通常の配列の場合、要素の更新は容易に $O(1)$ で処理できますが、区間に対する演算の計算量はその区間の長さに比例します。
セグメント木は、要素の更新を $O(\log |A|)$ とする代わりに、区間に対する演算の計算量をその区間の長さの対数に抑えます。

本実装では、完全二分木を用いて実装しています。
完全二分木を頂点数の2倍のサイズの配列 $a$ により表現しています。
配列 $a$ は1-indexedであり、$a$ の各要素は完全二分木の頂点に対応しています
（セグメント木のAPIは0-indexedであることに注意してください）。
$a[1]$ が根であり、$a[i]$ の親は $a[\lfloor i / 2 \rfloor]$, 左の子は $a[2i]$, 右の子は $a[2i + 1]$ です。

## API
セグメント木はジェネリックな型です。
以降、指定された型を $T$ とします。

### 状態空間
- $n' \in \mathbb{Z}_{\geq 0}$
- $f'$: 以下を満たす $T^2 \rightarrow T$
  - $\forall x, y, z \in T, f(f(x, y), z) = f(x, f(y, z))$
  - $\exists e \in T, \forall x \in T, f(x, e) = f(e, x) = x$
- $e'$: 以下を満たす $e' \in T$
  - $\forall x \in T, f(x, e') = f(e', x) = x$
- $A' = (A_{0}', \ldots, A_{n' - 1}') \in T^{n'}$

$f'$ は区間に適用する演算に対応します。
$A'$ は配列の各要素の状態に対応します。この配列は0-indexedです。

### コンストラクタ
要素数 $n$ のセグメント木を初期化します。要素数は2のべき乗である必要はありません。
セグメント木の区間に対する演算とその演算における単位元も初期化時に指定します。
セグメント木の各要素は単位元で初期化されます。

#### 引数
- $n \in \mathbb{Z}_{\geq 0}$
- $e$: 以下を満たす $e \in T$
  - $\forall x \in T, f(x, e) = f(e, x) = x$
- $f$: 以下を満たす $T^2 \rightarrow T$
  - $\forall x, y, z \in T, f(f(x, y), z) = f(x, f(y, z))$
  - $\exists e \in T, \forall x \in T, f(x, e) = f(e, x) = x$

#### 初期状態
- $n' = n$
- $f' = f$
- $e' = e$
- $A' = (e, \ldots, e)$

#### 計算量
$O(n)$

### update
指定した要素の値を更新します。指定するインデックスは0-indexedです。

#### 引数
- $i \in \\{0, 1, \ldots, n' - 1\\}$
- $x \in T$

#### 戻り値
なし

#### 状態変化
$A'_{i} \leftarrow x$

#### 計算量
$O(\log{n'})$

### query
指定した区間に対する演算結果を返します。区間は左閉右開区間であり、インデックスは0-indexedです。

#### 引数
- $i \in \\{0, 1, \ldots, n' - 1\\}$
- $j \in \\{0, 1, \ldots, n'\\}$

#### 戻り値
$f(f( \ldots f(f(A_{i}', A_{i + 1}'), A_{i + 2}') \ldots), A_{j - 1}')$

#### 状態変化
なし

#### 計算量
$O(\log{n'})$

{{< src >}}
