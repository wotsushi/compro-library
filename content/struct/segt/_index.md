---
title: セグメント木
version: 1.0
prefix: $segt
---

{{< meta >}}

区間に対する演算を高速に処理するデータ構造です。

## 説明
配列 $A$ に対して、要素の更新と結合律を満たす区間に対する演算を何回も処理する場合に有用なデータ構造です。
通常の配列の場合、要素の更新は容易に$O(1)$で処理できますが、区間に対する演算の計算量はその区間の長さに比例します。
セグメント木は、要素の更新を$O(\log |A|)$とする代わりに、区間に対する演算の計算量をその区間の長さの対数に抑えます。

本実装では、完全二分木を用いて実装しています。
完全二分木を頂点数の2倍のサイズの配列$a$により表現しています。
配列$a$は1-indexedであり、$a$の各要素は完全二分木の頂点に対応しています
（セグメント木のAPIは0-indexedであることに注意してください）。
$a[1]$が根であり、$a[i]$の親は$a[\lfloor i / 2 \rfloor]$, 左の子は$a[2i]$, 右の子は$a[2i + 1]$です。

## API

### コンストラクタ
要素数$n$のセグメント木を初期化します。
セグメント木の単位元と区間に対する演算も初期化時に指定します。
セグメント木の各要素$A[0], \ldots, A[n - 1]$は単位元で初期化されます。

- 引数
  - $n$: セグメント木の要素数（2のべき乗である必要なし; 自動的に調整される）
  - $e$: $f$ における単位元
  - $f$: 区間に対する関数（結合律を満たす必要がある）
- 副作用: $A[0] = \cdots = A[n - 1] = e$とし、区間に対する演算として$f$を採用する
- 計算量: $O(n)$

### update
指定した要素の値を更新します。

- 引数
  - $i$: 更新対象のインデックス(0-indexed)
  - $x$: 更新後の値
- 戻り値: なし
- 副作用: $A[i]$の値を$x$に更新する
- 計算量: $O(\log{n})$

### query
指定した区間に対する演算結果を返します。

- 引数
  - $i$: 区間の始端(0-indexed, inclusive)
  - $j$: 区間の終端(0-indexed, exclusive)
- 戻り値: $f(A[i], \ldots, A[j - 1])$
- 計算量: $O(\log{n})$

{{< src >}}
